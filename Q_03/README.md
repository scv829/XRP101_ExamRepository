# 3번 문제

주어진 프로젝트 는 다음의 기능을 구현하고자 생성한 프로젝트이다.

### 1. Turret
- Trigger 범위 내로 플레이어가 들어왔을 때 1.5초에 한번씩 플레이어를 바라보면서 총알을 발사한다
- Trigger 범위 바깥으로 플레이어가 나가면 발사를 중지한다.
- 오브젝트 풀을 사용해 총알을 관리한다.

### 2. Bullet :
- 20만큼의 힘으로 전방을 향해 발사된다
- 발사 후 5초 경과 시 비활성화 처리된다
- 플레이어를 가격했을 경우 2의 데미지를 준다

### 3. Player
- 총알과 충돌했을 때, 데미지를 입는다
- 체력이 0 이하가 될 경우 효과음을 재생하며 비활성화된다.
- 플레이어의 이동은 씬 뷰를 사용해 이동하도록 한다.

위 기능들을 구현하고자 할 때
제시된 프로젝트에서 발생하는 `문제들을 모두 서술`하고 올바르게 동작하도록 `소스코드를 개선`하시오.

## 답안

### 확인된 문제들

#### 1. 플레이어가 터렛 사거리 안에 들어가도 터렛 작동을 안함

- 원인
  - 충돌체는 있지만 충돌이 되었다는 연산을 할 `Rigidbody가 없음`
- 해결
  - 터렛에 중력을 받지 않는 Rigidbody 컴포넌트를 추가

#### 2. Bullet 오브젝트가 플레이어와 충돌했을 때 NullReferenceExecption 발생

- 원인
  - 충돌한 오브젝트에서 PlayerController 스크립트를 가져오지 못함
- 해결
  - 플레이어의 충돌이 `Body`에 들어있어서 해당 부모로 스크립트를 가져오게 변경

#### 3. 플레이어가 터렛 사거리에서 나갔는데도 계속 공격을 한다.
- 원인
  - `OnTriggerEnter`로 플레이어를 감지해서 공격을 하지만 공격 범위 밖으로 나가도 계속 공격을 한다.
- 해결
  - 공격 코루틴의 종료 시점이 따로 없다. 그래서 공격 범위 밖으로 나가는 의미인 `OnTriggerExit`에서 코루틴 종료 시점 설정

#### 4. Bullet의 속도가 계속 빨라져서 충돌을 인식 못함

- 원인
  - Bullet이 생성되고 초기에는 플레이어를 맞춰서 피해를 입히지만 시간이 지나 갈 수록 계속 빨라지면서 나중에 플레이어를 통과해서 피해를 안준다.
- 해결
  - 계속 공격을 하고 있으면 AddForce로 계속 힘을 더해주고 있기 때문에 해당 부분을 `velocity`로 변경해서 일정한 속도 유지되게 변경

#### 5. 플레이어 사망 시 효과음 재생 안함

- 원인
  - 플레이어의 체력이 0이 하가 될 때 게임 오브젝트가 비활성화가 되지만 효과음이 재생을 안한다.
- 방안
  - 게임 오브젝트가 비활성화 되면 효과음 자체가 안나온다
- 해결
  - 게임 오브젝트가 비활성화 되면 효과음 자체가 안나온다
  - 처음에는 효과음이 다 나오고 게임 오브젝트 비활성화 <- 코루틴으로 구현
    - ```C#
        // IEnumerator DieCoroutine()
        // {
        //     _audio.Play();
        //     float time = 0;
        //     while (time < _audio.clip.length)
        //     {
        //         time += Time.deltaTime;
        //         yield return null;
        //     }
        //     gameObject.SetActive(false);
        // }
        ```
    - 문제: 그런데 `게임 오브젝트 비활성화 + 효과음 재생`이 하나여서 해당 방법은 부적절함
  - 그래서 충돌체는 body가 가지고 있기 때문에 `body만 비활성화`하는 방법으로 사용하여 구현